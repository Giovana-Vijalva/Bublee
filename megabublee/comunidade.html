<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comunidade - Bublee</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-image: url('bubleefundo.png');
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
      min-height: 100vh;
      margin: 0;
    }
  </style>
</head>
<body class="relative min-h-screen flex flex-col">

  <header class="relative z-10 flex items-center justify-between px-8 py-4">
    <img src="bublee.png" alt="Logo" class="w-14 h-14 rounded-full border-2 border-pink-500 shadow-lg">
    <nav class="space-x-4">
      <a href="comunidade.html" class="px-6 py-2 bg-pink-500 text-white rounded-full hover:bg-pink-600 transition-all">COMUNIDADE</a>
      <a href="equipe.html" class="px-6 py-2 bg-pink-500 text-white rounded-full hover:bg-pink-600 transition-all">EQUIPE</a>
      <a href="projeto.html" class="px-6 py-2 bg-pink-500 text-white rounded-full hover:bg-pink-600 transition-all">PROJETO</a>
    </nav>
  </header>

  <main class="flex-grow flex items-center justify-center p-8">
    <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-2xl w-full max-w-2xl text-center">
      <h1 class="text-5xl font-extrabold text-pink-500 drop-shadow-lg mb-6">COMUNIDADE</h1>
      <p class="text-lg font-bold text-gray-700 mb-6">Troque ideias, tire dúvidas e compartilhe conhecimento com outros membros!</p>

      <div id="chat-box" class="h-64 overflow-y-scroll p-4 bg-gray-100 rounded-lg shadow-inner mb-4 text-left"></div>

      <div class="flex">
        <input id="message-input" type="text" placeholder="Digite sua mensagem..." class="flex-1 p-2 rounded-l-lg border border-gray-300 focus:outline-none" onkeypress="checkEnter(event)">
        <button onclick="sendMessage()" class="bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded-r-lg">Enviar</button>
      </div>
    </div>
  </main>

  <script>
    let usuario = JSON.parse(localStorage.getItem('usuario'));

    if (!usuario) {
      alert("Você precisa se cadastrar primeiro!");
      window.location.href = "cadastro.html";
    }

    const admins = [
      { nome: "Gabriela Mücke Vijalva", email: "Gabimucke2@gmail.com" },
      { nome: "Giovana Mücke Vijalva", email: "gigimucke@gamil.com" },
      { nome: "Isabely Cristiny Costa da Silva", email: "" }
    ];

    function isAdmin() {
      return admins.some(admin =>
        admin.nome === usuario.nome &&
        (admin.email === "" || admin.email === usuario.email)
      );
    }

    function loadMessages() {
      const messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
      const chatBox = document.getElementById('chat-box');
      chatBox.innerHTML = '';

      messages.forEach((message, index) => {
        const msgDiv = document.createElement('div');
        msgDiv.className = `p-2 my-2 rounded-lg flex justify-between items-center ${
          message.username !== usuario.nome ? 'bg-blue-100' : 'bg-pink-100'
        }`;

        let msgHtml = `<div><strong>${message.username}</strong><br>${message.text}</div>`;

        if (message.username === usuario.nome || isAdmin()) {
          msgHtml += `<button onclick="deleteMessage(${index})" class="ml-4 text-sm text-red-500 hover:underline">Apagar</button>`;
        }

        msgDiv.innerHTML = msgHtml;
        chatBox.appendChild(msgDiv);
      });

      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function sendMessage() {
      const messageInput = document.getElementById('message-input');
      const text = messageInput.value.trim();

      if (text !== '') {
        const messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
        messages.push({ username: usuario.nome, text });
        localStorage.setItem('chatMessages', JSON.stringify(messages));
        messageInput.value = '';
        loadMessages();
      }
    }

    function deleteMessage(index) {
      const messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
      const message = messages[index];

      if (message.username === usuario.nome || isAdmin()) {
        messages.splice(index, 1);
        localStorage.setItem('chatMessages', JSON.stringify(messages));
        loadMessages();
      } else {
        alert("Você não tem permissão para apagar esta mensagem.");
      }
    }

    function checkEnter(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        sendMessage();
      }
    }

    window.onload = loadMessages;
  </script>

</body>
</html>
